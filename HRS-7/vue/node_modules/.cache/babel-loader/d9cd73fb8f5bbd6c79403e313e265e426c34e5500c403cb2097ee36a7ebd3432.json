{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nexport default {\n  name: 'AppealDetail',\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || '{}'),\n      appeal: {},\n      appealOrder: this.$route.params.appealOrder,\n      error: null,\n      loading: true\n    };\n  },\n  created() {\n    this.fetchAppealDetail();\n  },\n  methods: {\n    fetchAppealDetail() {\n      this.$request.get('/registration/selectByAppealOrder', {\n        params: {\n          appealOrder: this.appealOrder\n        }\n      }).then(response => {\n        if (response.code == 200) {\n          this.appeal = response.data;\n        } else {\n          this.error = response.data.message || '获取申诉失败';\n        }\n      }).catch(error => {\n        console.error('获取申诉失败:', error);\n        this.error = '获取申诉失败，请稍后重试';\n      }).finally(() => {\n        this.loading = false;\n      });\n    },\n    formatStatus(status) {\n      switch (status) {\n        case 0:\n          return '待处理';\n        case 1:\n          return '处理完成';\n        case 2:\n          return '已取消';\n        default:\n          return '未知状态';\n      }\n    },\n    formatPhone(phone) {\n      if (phone && phone.length === 11) {\n        return phone.substring(0, 3) + '****' + phone.substring(7);\n      }\n      return phone;\n    },\n    handleAppeal() {\n      console.log('开始处理申诉，申诉单号：', this.appeal.appealOrder);\n      this.$request.post(`/registration/handleAppeal/${this.appeal.appealOrder}`).then(response => {\n        if (response.code == 200) {\n          console.log('申诉处理成功');\n          this.appeal.status = 1; // 假设处理中状态码为 1\n        } else {\n          this.error = response.data.message || '处理申诉失败';\n        }\n      }).catch(error => {\n        console.error('处理申诉失败:', error);\n        this.error = '处理申诉失败，请稍后重试';\n      });\n    },\n    viewAttachment(file) {\n      if (file) {\n        window.open(this.$baseUrl + '/files/preview/' + file);\n      } else {\n        console.log('没有附件文件');\n      }\n    },\n    downloadAttachment(file) {\n      if (file) {\n        fetch('/files/download', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            file: file\n          })\n        }).then(response => {\n          if (!response.ok) {\n            throw new Error('Network response was not ok');\n          }\n          return response.blob();\n        }).then(blob => {\n          const contentDisposition = response.headers.get('content-disposition');\n          let fileName = file;\n          if (contentDisposition) {\n            const matches = contentDisposition.match(/filename\\*=UTF-8''([^;]+)/);\n            if (matches && matches.length > 1) {\n              fileName = decodeURIComponent(matches[1]);\n            }\n          }\n          const url = window.URL.createObjectURL(blob);\n          const link = document.createElement('a');\n          link.href = url;\n          link.setAttribute('download', fileName);\n          document.body.appendChild(link);\n          link.click();\n          link.parentNode.removeChild(link);\n          window.URL.revokeObjectURL(url);\n          console.log('下载成功');\n        }).catch(error => {\n          console.error('下载失败:', error);\n        });\n      } else {\n        console.log('没有附件文件');\n      }\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","JSON","parse","localStorage","getItem","appeal","appealOrder","$route","params","error","loading","created","fetchAppealDetail","methods","$request","get","then","response","code","message","catch","console","finally","formatStatus","status","formatPhone","phone","length","substring","handleAppeal","log","post","viewAttachment","file","window","open","$baseUrl","downloadAttachment","fetch","method","headers","body","stringify","ok","Error","blob","contentDisposition","fileName","matches","match","decodeURIComponent","url","URL","createObjectURL","link","document","createElement","href","setAttribute","appendChild","click","parentNode","removeChild","revokeObjectURL"],"sources":["src/views/hospitalAdmin/AppealDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"appeal-detail\">\r\n    <el-button type=\"text\" @click=\"$router.go(-1)\">返回</el-button>\r\n    <h1>申诉详情</h1>\r\n    <el-descriptions :column=\"1\" border>\r\n      <el-descriptions-item label=\"申诉单号\">{{ appeal.appealOrder }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"患者姓名\">{{ appeal.patientName }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"患者电话\">{{ formatPhone(appeal.patientPhone) }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"患者性别\">{{ appeal.patientGender }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"医院\">{{ appeal.hospital }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"部门\">{{ appeal.department }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"医生\">{{ appeal.doctor }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"附件\">\r\n        <span @click=\"viewAttachment(appeal.file)\" style=\"color: blue; cursor: pointer;\">\r\n          {{ appeal.file }}\r\n        </span>\r\n        <el-button size=\"small\" type=\"success\" @click=\"downloadAttachment(appeal.file)\">下载</el-button>\r\n      </el-descriptions-item>\r\n      <el-descriptions-item label=\"申诉内容\">{{ appeal.appealContent }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"申诉时间\">{{ appeal.appealTime }}</el-descriptions-item>\r\n      <el-descriptions-item label=\"状态\">{{ formatStatus(appeal.status) }}</el-descriptions-item>\r\n\r\n    </el-descriptions>\r\n    <!-- 根据状态动态显示按钮文本 -->\r\n    <el-button type=\"primary\" @click=\"appeal.status === 0 ? handleAppeal() : $router.go(-1)\">\r\n      <span v-if=\"appeal.status === 0\">处理申诉</span>\r\n      <span v-else-if=\"appeal.status === 1\">提交</span>\r\n    </el-button>\r\n    <p v-if=\"error\" style=\"color: red;\">{{ error }}</p>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'AppealDetail',\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || '{}'),\r\n      appeal: {},\r\n      appealOrder: this.$route.params.appealOrder,\r\n      error: null,\r\n      loading: true\r\n    };\r\n  },\r\n  created() {\r\n    this.fetchAppealDetail();\r\n  },\r\n  methods: {\r\n    fetchAppealDetail() {\r\n      this.$request.get('/registration/selectByAppealOrder', {\r\n        params: {\r\n          appealOrder: this.appealOrder,\r\n        },\r\n      }).then(response => {\r\n        if (response.code == 200) {\r\n          this.appeal = response.data;\r\n        } else {\r\n          this.error = response.data.message || '获取申诉失败';\r\n        }\r\n      })\r\n          .catch(error => {\r\n            console.error('获取申诉失败:', error);\r\n            this.error = '获取申诉失败，请稍后重试';\r\n          })\r\n          .finally(() => {\r\n            this.loading = false;\r\n          });\r\n    },\r\n    formatStatus(status) {\r\n      switch (status) {\r\n        case 0:\r\n          return '待处理';\r\n        case 1:\r\n          return '处理完成';\r\n        case 2:\r\n          return '已取消';\r\n        default:\r\n          return '未知状态';\r\n      }\r\n    },\r\n    formatPhone(phone) {\r\n      if (phone && phone.length === 11) {\r\n        return phone.substring(0, 3) + '****' + phone.substring(7);\r\n      }\r\n      return phone;\r\n    },\r\n    handleAppeal() {\r\n      console.log('开始处理申诉，申诉单号：', this.appeal.appealOrder);\r\n      this.$request.post(`/registration/handleAppeal/${this.appeal.appealOrder}`).then(response => {\r\n        if (response.code == 200) {\r\n          console.log('申诉处理成功');\r\n          this.appeal.status = 1; // 假设处理中状态码为 1\r\n        } else {\r\n          this.error = response.data.message || '处理申诉失败';\r\n        }\r\n      }).catch(error => {\r\n        console.error('处理申诉失败:', error);\r\n        this.error = '处理申诉失败，请稍后重试';\r\n      });\r\n    },\r\n    viewAttachment(file) {\r\n      if (file) {\r\n        window.open(this.$baseUrl + '/files/preview/' + file)\r\n      } else {\r\n        console.log('没有附件文件');\r\n      }\r\n    },\r\n    downloadAttachment(file) {\r\n      if (file) {\r\n        fetch('/files/download', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            file: file\r\n          })\r\n        })\r\n            .then(response => {\r\n              if (!response.ok) {\r\n                throw new Error('Network response was not ok');\r\n              }\r\n              return response.blob();\r\n            })\r\n            .then(blob => {\r\n              const contentDisposition = response.headers.get('content-disposition');\r\n              let fileName = file;\r\n              if (contentDisposition) {\r\n                const matches = contentDisposition.match(/filename\\*=UTF-8''([^;]+)/);\r\n                if (matches && matches.length > 1) {\r\n                  fileName = decodeURIComponent(matches[1]);\r\n                }\r\n              }\r\n              const url = window.URL.createObjectURL(blob);\r\n              const link = document.createElement('a');\r\n              link.href = url;\r\n              link.setAttribute('download', fileName);\r\n              document.body.appendChild(link);\r\n              link.click();\r\n              link.parentNode.removeChild(link);\r\n              window.URL.revokeObjectURL(url);\r\n              console.log('下载成功');\r\n            })\r\n            .catch(error => {\r\n              console.error('下载失败:', error);\r\n            });\r\n      } else {\r\n        console.log('没有附件文件');\r\n      }\r\n    }\r\n\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.appeal-detail {\r\n  padding: 20px;\r\n}\r\n\r\n.el-descriptions {\r\n  margin-top: 20px;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}