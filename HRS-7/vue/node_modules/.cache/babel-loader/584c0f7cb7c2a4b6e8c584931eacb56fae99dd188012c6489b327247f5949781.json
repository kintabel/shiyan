{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"prescribing-administration\"\n};\nconst _hoisted_2 = {\n  style: {\n    \"float\": \"right\",\n    \"color\": \"#8492a6\",\n    \"font-size\": \"13px\"\n  }\n};\nconst _hoisted_3 = {\n  \"slot-scope\": \"scope\"\n};\nconst _hoisted_4 = {\n  class: \"submit-section\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_option = _resolveComponent(\"el-option\");\n  const _component_el_select = _resolveComponent(\"el-select\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_input_number = _resolveComponent(\"el-input-number\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_table_column = _resolveComponent(\"el-table-column\");\n  const _component_el_table = _resolveComponent(\"el-table\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[10] || (_cache[10] = _createElementVNode(\"h2\", null, \"开药管理\", -1 /* HOISTED */)), _createVNode(_component_el_button, {\n    type: \"text\",\n    onClick: _cache[0] || (_cache[0] = $event => _ctx.$router.go(-1))\n  }, {\n    default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\"返回\")])),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 开药表单 \"), _createVNode(_component_el_form, {\n    model: $data.prescriptionForm,\n    \"label-width\": \"120px\",\n    class: \"prescription-form\"\n  }, {\n    default: _withCtx(() => [_createCommentVNode(\" 药品名称下拉框 \"), _createVNode(_component_el_form_item, {\n      label: \"药品名称\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_select, {\n        modelValue: $data.prescriptionForm.drugName,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.prescriptionForm.drugName = $event),\n        placeholder: \"请选择药品\",\n        filterable: \"\",\n        clearable: \"\",\n        onChange: $options.handleDrugChange\n      }, {\n        default: _withCtx(() => [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.drugOptions, drug => {\n          return _openBlock(), _createBlock(_component_el_option, {\n            key: drug.id,\n            label: drug.name,\n            value: drug.name\n          }, {\n            default: _withCtx(() => [_createElementVNode(\"span\", null, _toDisplayString(drug.name), 1 /* TEXT */), _createElementVNode(\"span\", _hoisted_2, \" 库存: \" + _toDisplayString(drug.stock), 1 /* TEXT */)]),\n\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"label\", \"value\"]);\n        }), 128 /* KEYED_FRAGMENT */))]),\n\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\", \"onChange\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"药品数量\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input_number, {\n        modelValue: $data.prescriptionForm.quantity,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.prescriptionForm.quantity = $event),\n        min: 1,\n        max: $options.getMaxQuantity($data.prescriptionForm.drugName)\n      }, null, 8 /* PROPS */, [\"modelValue\", \"max\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, {\n      label: \"用药说明\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        type: \"textarea\",\n        modelValue: $data.prescriptionForm.instructions,\n        \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.prescriptionForm.instructions = $event),\n        placeholder: \"请输入用药说明\"\n      }, null, 8 /* PROPS */, [\"modelValue\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, null, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $options.handleAddPrescription\n      }, {\n        default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\"添加药品\")])),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_button, {\n        type: \"info\",\n        onClick: $options.handleResetForm\n      }, {\n        default: _withCtx(() => _cache[7] || (_cache[7] = [_createTextVNode(\"重置\")])),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\"])]),\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\"]), _createCommentVNode(\" 已开药品列表 \"), _createVNode(_component_el_table, {\n    data: $data.prescriptionList,\n    stripe: \"\",\n    class: \"prescription-table\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_table_column, {\n      prop: \"drugName\",\n      label: \"药品名称\",\n      width: \"180\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"quantity\",\n      label: \"数量\",\n      width: \"100\"\n    }), _createVNode(_component_el_table_column, {\n      prop: \"instructions\",\n      label: \"用药说明\"\n    }), _createVNode(_component_el_table_column, {\n      label: \"操作\",\n      width: \"120\"\n    }, {\n      default: _withCtx(() => [_createElementVNode(\"template\", _hoisted_3, [_createVNode(_component_el_button, {\n        type: \"danger\",\n        size: \"small\",\n        onClick: _cache[4] || (_cache[4] = $event => $options.handleDeletePrescription(_ctx.scope.row))\n      }, {\n        default: _withCtx(() => _cache[8] || (_cache[8] = [_createTextVNode(\"删除\")])),\n        _: 1 /* STABLE */\n      })])]),\n\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"data\"]), _createCommentVNode(\" 提交按钮 \"), _createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_el_button, {\n    type: \"success\",\n    onClick: $options.handleSubmitPrescription\n  }, {\n    default: _withCtx(() => _cache[9] || (_cache[9] = [_createTextVNode(\"提交开药\")])),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"onClick\"])])]);\n}","map":{"version":3,"names":["class","style","_createElementBlock","_hoisted_1","_createElementVNode","_createVNode","_component_el_button","type","onClick","_cache","$event","_ctx","$router","go","_createCommentVNode","_component_el_form","model","$data","prescriptionForm","_component_el_form_item","label","_component_el_select","drugName","placeholder","filterable","clearable","onChange","$options","handleDrugChange","_Fragment","_renderList","drugOptions","drug","_createBlock","_component_el_option","key","id","name","value","_toDisplayString","_hoisted_2","stock","_component_el_input_number","quantity","min","max","getMaxQuantity","_component_el_input","instructions","handleAddPrescription","handleResetForm","_component_el_table","data","prescriptionList","stripe","_component_el_table_column","prop","width","_hoisted_3","size","handleDeletePrescription","scope","row","_hoisted_4","handleSubmitPrescription"],"sources":["E:\\专业设计项目\\HRS\\HRS-7\\vue\\src\\views\\doctor\\Prescription.vue"],"sourcesContent":["<template>\r\n  <div class=\"prescribing-administration\">\r\n    <h2>开药管理</h2>\r\n    <el-button type=\"text\" @click=\"$router.go(-1)\">返回</el-button>\r\n\r\n    <!-- 开药表单 -->\r\n    <el-form :model=\"prescriptionForm\" label-width=\"120px\" class=\"prescription-form\">\r\n      <!-- 药品名称下拉框 -->\r\n      <el-form-item label=\"药品名称\">\r\n        <el-select\r\n            v-model=\"prescriptionForm.drugName\"\r\n            placeholder=\"请选择药品\"\r\n            filterable\r\n            clearable\r\n            @change=\"handleDrugChange\"\r\n        >\r\n          <el-option\r\n              v-for=\"drug in drugOptions\"\r\n              :key=\"drug.id\"\r\n              :label=\"drug.name\"\r\n              :value=\"drug.name\"\r\n          >\r\n            <span>{{ drug.name }}</span>\r\n            <span style=\"float: right; color: #8492a6; font-size: 13px\">\r\n              库存: {{ drug.stock }}\r\n            </span>\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"药品数量\">\r\n        <el-input-number\r\n            v-model=\"prescriptionForm.quantity\"\r\n            :min=\"1\"\r\n            :max=\"getMaxQuantity(prescriptionForm.drugName)\"\r\n        ></el-input-number>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"用药说明\">\r\n        <el-input\r\n            type=\"textarea\"\r\n            v-model=\"prescriptionForm.instructions\"\r\n            placeholder=\"请输入用药说明\"\r\n        ></el-input>\r\n      </el-form-item>\r\n\r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleAddPrescription\">添加药品</el-button>\r\n        <el-button type=\"info\" @click=\"handleResetForm\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <!-- 已开药品列表 -->\r\n    <el-table :data=\"prescriptionList\" stripe class=\"prescription-table\">\r\n      <el-table-column prop=\"drugName\" label=\"药品名称\" width=\"180\"></el-table-column>\r\n      <el-table-column prop=\"quantity\" label=\"数量\" width=\"100\"></el-table-column>\r\n      <el-table-column prop=\"instructions\" label=\"用药说明\"></el-table-column>\r\n      <el-table-column label=\"操作\" width=\"120\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button type=\"danger\" size=\"small\" @click=\"handleDeletePrescription(scope.row)\"\r\n          >删除</el-button\r\n          >\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 提交按钮 -->\r\n    <div class=\"submit-section\">\r\n      <el-button type=\"success\" @click=\"handleSubmitPrescription\">提交开药</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'PrescribingAdministration',\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || '{}'),\r\n      // 开药表单数据\r\n      prescriptionForm: {\r\n        drugId: '', // 药品ID\r\n        drugName: '', // 药品名称\r\n        quantity: 1, // 药品数量\r\n        instructions: '', // 用药说明\r\n      },\r\n      // 已开药品列表\r\n      prescriptionList: [],\r\n      // 药物库存选项\r\n      drugOptions: [],\r\n    };\r\n  },\r\n  created() {\r\n    this.fetchDrugStock(); // 加载药物库存信息\r\n  },\r\n  methods: {\r\n    // 获取药物库存信息\r\n    fetchDrugStock() {\r\n      console.log(this.$route.params.id)\r\n      console.log(this.user.id)\r\n      this.$request\r\n          .get('/stock/selectByDocId', {\r\n            params: {\r\n             doctorId: this.user.id,\r\n            },\r\n          })\r\n          .then((response) => {\r\n            if (response.data && response.data.length > 0) {\r\n              this.drugOptions = response.data.filter((drug) => drug.type === 1); // 只显示药物类型\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            console.error('获取药物库存信息失败:', error);\r\n            this.$message.error('获取药物库存信息失败，请稍后重试');\r\n          });\r\n    },\r\n\r\n    // 处理药物选择\r\n    handleDrugChange(selectedDrugName) {\r\n      const selectedDrug = this.drugOptions.find((drug) => drug.name === selectedDrugName);\r\n      if (selectedDrug) {\r\n        this.prescriptionForm.drugName = selectedDrug.name;\r\n        this.prescriptionForm.quantity = 1; // 重置数量\r\n      }\r\n    },\r\n\r\n    // 获取药品的最大数量（基于库存）\r\n    getMaxQuantity(drugName) {\r\n      const selectedDrug = this.drugOptions.find((drug) => drug.name === drugName);\r\n      return selectedDrug ? selectedDrug.stock : 100; // 默认最大值为100\r\n    },\r\n\r\n    // 添加药品到列表\r\n    handleAddPrescription() {\r\n      if (!this.prescriptionForm.drugName || !this.prescriptionForm.instructions) {\r\n        this.$message.warning('请填写完整的药品信息');\r\n        return;\r\n      }\r\n      this.prescriptionList.push({ ...this.prescriptionForm });\r\n      this.handleResetForm(); // 添加后重置表单\r\n    },\r\n\r\n    // 重置表单\r\n    handleResetForm() {\r\n      this.prescriptionForm = {\r\n        drugName: '',\r\n        quantity: 1,\r\n        instructions: '',\r\n      };\r\n    },\r\n\r\n    // 删除药品\r\n    handleDeletePrescription(row) {\r\n      this.prescriptionList = this.prescriptionList.filter(\r\n          (item) => item.drugName !== row.drugName\r\n      );\r\n      this.$message.success('删除成功');\r\n    },\r\n\r\n    // 提交开药\r\n    handleSubmitPrescription() {\r\n      if (this.prescriptionList.length === 0) {\r\n        this.$message.warning('请至少添加一种药品');\r\n        return;\r\n      }\r\n      this.$confirm('是否确认提交开药信息？', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning',\r\n      })\r\n          .then(() => {\r\n            // 组合要发送的数据\r\n            const dataToSend = {\r\n              prescriptions: this.prescriptionList,\r\n              order: this.$route.params.id\r\n            };\r\n            this.$request.post('/prescribe/submit', dataToSend)\r\n                .then(response => {\r\n                  if (response.code == 200) {\r\n                    this.$message.success('开药信息提交成功');\r\n                    this.prescriptionList = []; // 清空列表\r\n                  } else {\r\n                    this.$message.error(response.data.message || '开药信息提交失败');\r\n                  }\r\n                })\r\n                .catch(error => {\r\n                  console.error('开药信息提交失败:', error);\r\n                  this.$message.error('开药信息提交失败，请稍后重试');\r\n                });\r\n          })\r\n          .catch(() => {\r\n            this.$message.info('已取消提交');\r\n          });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.prescribing-administration {\r\n  padding: 20px;\r\n}\r\n\r\n.prescription-form {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.prescription-table {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.submit-section {\r\n  text-align: right;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}