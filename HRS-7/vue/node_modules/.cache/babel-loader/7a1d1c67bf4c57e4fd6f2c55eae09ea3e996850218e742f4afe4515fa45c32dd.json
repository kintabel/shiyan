{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { parseTime } from '@/utils';\nexport default {\n  name: 'Registration',\n  data() {\n    return {\n      doctor: null,\n      shiftType: parseInt(this.$route.query.shiftType) || 1,\n      // 1-白天 2-晚上\n      currentHour: new Date().getHours(),\n      selectedTimeSlot: '',\n      availableTimeSlots: [],\n      isLoading: true\n    };\n  },\n  computed: {\n    // 当前时间是否有效\n    isValidTime() {\n      if (this.shiftType === 1) {\n        // 白天班(9-18点)只能在白天预约\n        return this.currentHour >= 8 && this.currentHour < 18;\n      } else {\n        // 夜班(18-次日9点)只能在晚上预约\n        return this.currentHour >= 18 || this.currentHour < 8;\n      }\n    },\n    // 时间范围提示\n    timeRangeHint() {\n      return this.shiftType === 1 ? '白班时间段: 9:00-12:00, 14:00-18:00' : '夜班时间段: 18:00-23:00, 0:00-8:00';\n    },\n    // 无效时间提示\n    invalidTimeMessage() {\n      return this.shiftType === 1 ? '当前非白天时段(8:00-18:00)，无法预约白班医生' : '当前非夜间时段(18:00-次日8:00)，无法预约夜班医生';\n    }\n  },\n  created() {\n    const doctorId = this.$route.params.doctorId;\n    if (doctorId) {\n      this.fetchDoctorInfo(doctorId).then(() => {\n        this.generateTimeSlots();\n      });\n    }\n  },\n  methods: {\n    // 生成时间段\n    generateTimeSlots() {\n      if (this.shiftType === 1) {\n        // 白班时间段\n        this.availableTimeSlots = [{\n          time: '09:00-10:00',\n          price: this.getPrice(true)\n        }, {\n          time: '10:00-11:00',\n          price: this.getPrice(true)\n        }, {\n          time: '11:00-12:00',\n          price: this.getPrice(true)\n        }, {\n          time: '14:00-15:00',\n          price: this.getPrice(true)\n        }, {\n          time: '15:00-16:00',\n          price: this.getPrice(true)\n        }, {\n          time: '16:00-17:00',\n          price: this.getPrice(true)\n        }, {\n          time: '17:00-18:00',\n          price: this.getPrice(true)\n        }];\n      } else {\n        // 夜班时间段\n        this.availableTimeSlots = [{\n          time: '18:00-19:00',\n          price: this.getPrice(false)\n        }, {\n          time: '19:00-20:00',\n          price: this.getPrice(false)\n        }, {\n          time: '20:00-21:00',\n          price: this.getPrice(false)\n        }, {\n          time: '21:00-22:00',\n          price: this.getPrice(false)\n        }, {\n          time: '22:00-23:00',\n          price: this.getPrice(false)\n        }, {\n          time: '23:00-00:00',\n          price: this.getPrice(false)\n        }, {\n          time: '00:00-01:00',\n          price: this.getPrice(false)\n        }\n        // 添加更多夜班时间段...\n        ];\n      }\n\n      this.isLoading = false;\n    },\n    // 检查时间段是否可用\n    isTimeSlotAvailable(slot) {\n      const now = new Date();\n      const currentHours = now.getHours();\n      const currentMinutes = now.getMinutes();\n\n      // 获取时间段的小时数\n      const slotStart = parseInt(slot.time.split(':')[0]);\n\n      // 如果当前时间已经过了该时间段，则不可用\n      if (currentHours > slotStart) return false;\n      if (currentHours === slotStart && currentMinutes > 0) return false;\n      return true;\n    },\n    // 提交预约\n    submitRegistration() {\n      if (!this.selectedTimeSlot) {\n        this.$message.warning('请选择预约时间段');\n        return;\n      }\n      this.$router.push({\n        name: 'SubmitRegistration',\n        query: {\n          doctorId: this.doctor.id,\n          timeSlot: this.selectedTimeSlot,\n          price: this.availableTimeSlots.find(s => s.time === this.selectedTimeSlot).price,\n          shiftType: this.shiftType,\n          status: this.$route.query.status\n        }\n      });\n    },\n    // 其他方法保持不变...\n    fetchDoctorInfo(doctorId) {\n      return this.$request.get('/doctor/selectDoctorById', {\n        params: {\n          doctorId\n        }\n      }).then(response => {\n        if (response.data) {\n          this.doctor = response.data;\n        } else {\n          console.error('获取医生详细信息失败:', response.data);\n          this.$message.error('获取医生详细信息失败，请稍后重试');\n        }\n      }).catch(error => {\n        console.error('获取医生详细信息失败:', error);\n        this.$message.error('获取医生详细信息失败，请稍后重试');\n      });\n    },\n    getDoctorTitle(status) {\n      switch (status) {\n        case 1:\n          return '医师';\n        case 2:\n          return '副主治医师';\n        case 3:\n          return '主治医师';\n        case 4:\n          return '专家';\n        case 5:\n          return '急诊';\n        default:\n          return '未知职称';\n      }\n    },\n    getPrice(isMorning) {\n      if (!this.doctor) return 0;\n      switch (this.doctor.status) {\n        case 1:\n          return isMorning ? 50 : 60;\n        case 2:\n          return isMorning ? 80 : 90;\n        case 3:\n          return isMorning ? 100 : 110;\n        case 4:\n          return isMorning ? 150 : 160;\n        case 5:\n          return isMorning ? 60 : 70;\n        default:\n          return 0;\n      }\n    }\n  }\n};","map":{"version":3,"names":["parseTime","name","data","doctor","shiftType","parseInt","$route","query","currentHour","Date","getHours","selectedTimeSlot","availableTimeSlots","isLoading","computed","isValidTime","timeRangeHint","invalidTimeMessage","created","doctorId","params","fetchDoctorInfo","then","generateTimeSlots","methods","time","price","getPrice","isTimeSlotAvailable","slot","now","currentHours","currentMinutes","getMinutes","slotStart","split","submitRegistration","$message","warning","$router","push","id","timeSlot","find","s","status","$request","get","response","console","error","catch","getDoctorTitle","isMorning"],"sources":["src/views/user/Registration.vue"],"sourcesContent":["<template>\r\n  <div class=\"registration-page\">\r\n    <!-- 医生信息展示 -->\r\n    <div class=\"doctor-info\" v-if=\"doctor\">\r\n      <h2>{{ doctor.name }} - {{ getDoctorTitle(doctor.status) }}</h2>\r\n      <p>{{ doctor.introduction }}</p>\r\n      <el-tag :type=\"shiftType === 1 ? 'success' : 'warning'\">\r\n        {{ shiftType === 1 ? '白班医生' : '夜班医生' }}\r\n      </el-tag>\r\n    </div>\r\n\r\n    <!-- 时间段选择 -->\r\n    <div class=\"time-slot-selection\" v-if=\"doctor\">\r\n      <h2>选择预约时间段</h2>\r\n\r\n      <div v-if=\"isValidTime\">\r\n        <el-alert\r\n            :title=\"timeRangeHint\"\r\n            type=\"info\"\r\n            show-icon\r\n            class=\"time-hint\"\r\n        />\r\n\r\n        <el-radio-group v-model=\"selectedTimeSlot\">\r\n          <el-radio-button\r\n              v-for=\"(slot, index) in availableTimeSlots\"\r\n              :key=\"index\"\r\n              :label=\"slot.time\"\r\n              :disabled=\"!isTimeSlotAvailable(slot)\"\r\n          >\r\n            {{ slot.time }} ({{ slot.price }}元)\r\n          </el-radio-button>\r\n        </el-radio-group>\r\n\r\n        <el-button\r\n            type=\"primary\"\r\n            @click=\"submitRegistration\"\r\n            :disabled=\"!selectedTimeSlot\"\r\n            class=\"submit-btn\"\r\n        >\r\n          确认预约\r\n        </el-button>\r\n      </div>\r\n\r\n      <div v-else class=\"invalid-time\">\r\n        <el-alert\r\n            :title=\"invalidTimeMessage\"\r\n            type=\"error\"\r\n            show-icon\r\n        />\r\n      </div>\r\n    </div>\r\n\r\n    <div v-else>\r\n      <p>未获取到医生信息，请稍后重试。</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { parseTime } from '@/utils'\r\n\r\nexport default {\r\n  name: 'Registration',\r\n  data() {\r\n    return {\r\n      doctor: null,\r\n      shiftType: parseInt(this.$route.query.shiftType) || 1, // 1-白天 2-晚上\r\n      currentHour: new Date().getHours(),\r\n      selectedTimeSlot: '',\r\n      availableTimeSlots: [],\r\n      isLoading: true\r\n    }\r\n  },\r\n  computed: {\r\n    // 当前时间是否有效\r\n    isValidTime() {\r\n      if (this.shiftType === 1) {\r\n        // 白天班(9-18点)只能在白天预约\r\n        return this.currentHour >= 8 && this.currentHour < 18\r\n      } else {\r\n        // 夜班(18-次日9点)只能在晚上预约\r\n        return this.currentHour >= 18 || this.currentHour < 8\r\n      }\r\n    },\r\n\r\n    // 时间范围提示\r\n    timeRangeHint() {\r\n      return this.shiftType === 1\r\n          ? '白班时间段: 9:00-12:00, 14:00-18:00'\r\n          : '夜班时间段: 18:00-23:00, 0:00-8:00'\r\n    },\r\n\r\n    // 无效时间提示\r\n    invalidTimeMessage() {\r\n      return this.shiftType === 1\r\n          ? '当前非白天时段(8:00-18:00)，无法预约白班医生'\r\n          : '当前非夜间时段(18:00-次日8:00)，无法预约夜班医生'\r\n    }\r\n  },\r\n  created() {\r\n    const doctorId = this.$route.params.doctorId\r\n    if (doctorId) {\r\n      this.fetchDoctorInfo(doctorId).then(() => {\r\n        this.generateTimeSlots()\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    // 生成时间段\r\n    generateTimeSlots() {\r\n      if (this.shiftType === 1) {\r\n        // 白班时间段\r\n        this.availableTimeSlots = [\r\n          { time: '09:00-10:00', price: this.getPrice(true) },\r\n          { time: '10:00-11:00', price: this.getPrice(true) },\r\n          { time: '11:00-12:00', price: this.getPrice(true) },\r\n          { time: '14:00-15:00', price: this.getPrice(true) },\r\n          { time: '15:00-16:00', price: this.getPrice(true) },\r\n          { time: '16:00-17:00', price: this.getPrice(true) },\r\n          { time: '17:00-18:00', price: this.getPrice(true) }\r\n        ]\r\n      } else {\r\n        // 夜班时间段\r\n        this.availableTimeSlots = [\r\n          { time: '18:00-19:00', price: this.getPrice(false) },\r\n          { time: '19:00-20:00', price: this.getPrice(false) },\r\n          { time: '20:00-21:00', price: this.getPrice(false) },\r\n          { time: '21:00-22:00', price: this.getPrice(false) },\r\n          { time: '22:00-23:00', price: this.getPrice(false) },\r\n          { time: '23:00-00:00', price: this.getPrice(false) },\r\n          { time: '00:00-01:00', price: this.getPrice(false) },\r\n          // 添加更多夜班时间段...\r\n        ]\r\n      }\r\n      this.isLoading = false\r\n    },\r\n\r\n    // 检查时间段是否可用\r\n    isTimeSlotAvailable(slot) {\r\n      const now = new Date()\r\n      const currentHours = now.getHours()\r\n      const currentMinutes = now.getMinutes()\r\n\r\n      // 获取时间段的小时数\r\n      const slotStart = parseInt(slot.time.split(':')[0])\r\n\r\n      // 如果当前时间已经过了该时间段，则不可用\r\n      if (currentHours > slotStart) return false\r\n      if (currentHours === slotStart && currentMinutes > 0) return false\r\n\r\n      return true\r\n    },\r\n\r\n    // 提交预约\r\n    submitRegistration() {\r\n      if (!this.selectedTimeSlot) {\r\n        this.$message.warning('请选择预约时间段')\r\n        return\r\n      }\r\n\r\n      this.$router.push({\r\n        name: 'SubmitRegistration',\r\n        query: {\r\n          doctorId: this.doctor.id,\r\n          timeSlot: this.selectedTimeSlot,\r\n          price: this.availableTimeSlots.find(s => s.time === this.selectedTimeSlot).price,\r\n          shiftType: this.shiftType,\r\n          status: this.$route.query.status\r\n        }\r\n      })\r\n    },\r\n\r\n    // 其他方法保持不变...\r\n    fetchDoctorInfo(doctorId) {\r\n      return this.$request.get('/doctor/selectDoctorById', {\r\n        params: { doctorId }\r\n      })\r\n          .then(response => {\r\n            if (response.data) {\r\n              this.doctor = response.data\r\n            } else {\r\n              console.error('获取医生详细信息失败:', response.data)\r\n              this.$message.error('获取医生详细信息失败，请稍后重试')\r\n            }\r\n          })\r\n          .catch(error => {\r\n            console.error('获取医生详细信息失败:', error)\r\n            this.$message.error('获取医生详细信息失败，请稍后重试')\r\n          })\r\n    },\r\n\r\n    getDoctorTitle(status) {\r\n      switch (status) {\r\n        case 1: return '医师'\r\n        case 2: return '副主治医师'\r\n        case 3: return '主治医师'\r\n        case 4: return '专家'\r\n        case 5: return '急诊'\r\n        default: return '未知职称'\r\n      }\r\n    },\r\n\r\n    getPrice(isMorning) {\r\n      if (!this.doctor) return 0\r\n\r\n      switch (this.doctor.status) {\r\n        case 1: return isMorning ? 50 : 60\r\n        case 2: return isMorning ? 80 : 90\r\n        case 3: return isMorning ? 100 : 110\r\n        case 4: return isMorning ? 150 : 160\r\n        case 5: return isMorning ? 60 : 70\r\n        default: return 0\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n/* 样式保持不变 */\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}